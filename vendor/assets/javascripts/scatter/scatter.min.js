(function(){var ie=(navigator.appName=="Microsoft Internet Explorer"),s=window.Scatter={scanPage:function(root){function check(el){if(el.getAttribute("rel")=="scatter"){var isA=el.nodeName=="A";s.attach(el,isA?"click":"submit",s.send);if(!isA){addButtonDetection(el)}}}function addButtonDetection(form){for(var i=0,els=form.elements,l=els.length;i<l;i++){if(els[i].type=="submit"){s.attach(els[i],"click",function(event){event[ie?"srcElement":"target"].clicked=1})}}}if(!root){root=document.body}check(root);for(var type in {form:1,a:1}){for(var i=0,els=root.getElementsByTagName(type);i<els.length;i++){check(els[i])}}},send:function(event){var el=ie?event.srcElement:event.target;if(el.tagName=="FORM"){s.submit(el)}if(el.tagName=="A"){s.get(el.getAttribute("href"))}ie?event.returnValue=false:event.preventDefault()},xhr:function(method,url,ps,h){if(!h){h=s.scatter}var xhr=ie?new ActiveXObject("Microsoft.XmlHttp"):new XMLHttpRequest();xhr.open(method,url,true);if(method=="post"){xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded")}else{url+=((url.indexOf("?")<0)?"?":"&")+ps;ps=null}if(ps){xhr.setRequestHeader("Content-length",ps.length)}xhr.onreadystatechange=function(){if(xhr.readyState==4){h(xhr)}};xhr.send(ps)},get:function(url,ps,h){s.xhr("get",url,ps,h)},post:function(url,ps,h){s.xhr("post",url,ps,h)},put:function(url,ps,h){s.xhr("put",url,ps,h)},"delete":function(url,ps,h){s.xhr("delete",url,ps,h)},submit:function(form,h){var ps="",i=0,el,value;for(;el=form.elements[i++];){if(!el.name){continue}value=escape(el.value);switch(true){case el.type=="submit"&&!el.clicked:continue;case el.type=="radio"&&!el.checked:case el.type=="checkbox"&&!el.checked:continue;case el.type=="submit":el.clicked=undefined;default:ps+=((ps=="")?"":"&")+el.name+"="+value}}var attrs=form.attributes,method=attrs.method?attrs.method.nodeValue.toLowerCase():"get",a=attrs.action,av=a?a.nodeValue:0,url=av?av:document.location;s.xhr(method,url,ps,h)},scatter:function(xhr){function swap(el,newEl){el.style.display="none";el.parentNode.insertBefore(newEl,el);el.parentNode.removeChild(el);s.scanPage(newEl)}var script="",els=[],html=xhr.responseText.replace(/<script[^>]*?>([^<]*?)<\/script>/gim,function(a,b,c){script+=b;return""}),temp=document.createElement("div"),child,i,l,targetEl,id;temp.innerHTML=html.replace(/^<[!|?].*?>[\n|\r]*/,"");for(i=0,l=temp.childNodes.length;i<l;i++){els.push(temp.childNodes[i])}for(i=0;i<l;i++){child=els[i];if(child.nodeType==1){id=child.getAttribute("id");if(id){targetEl=document.getElementById(id);if(targetEl){swap(targetEl,child)}}}}eval(script)},attach:function(el,name,h){ie?el.attachEvent("on"+name,h):el.addEventListener(name,h,false)}}})();
